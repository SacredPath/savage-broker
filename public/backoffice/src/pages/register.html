<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account - Broker</title>
    
    <!-- Icons -->
    <link rel="icon" href="/icons/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="manifest" href="/manifest.json">
    
    <link rel="stylesheet" href="/src/css/ui-kit.css">
    <link rel="stylesheet" href="/src/css/pages.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Registration specific styles */
        .registration-container {
            min-height: 100vh;
            background: var(--background);
            display: flex;
            flex-direction: column;
        }
        
        .registration-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
        }
        
        .registration-logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .registration-tagline {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .registration-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .registration-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .registration-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .registration-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 32px;
            font-size: 14px;
        }
        
        /* Stepper Styles */
        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        
        .stepper::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            z-index: 0;
        }
        
        .stepper-progress {
            position: absolute;
            top: 20px;
            left: 0;
            height: 2px;
            background: var(--primary);
            z-index: 1;
            transition: width 0.3s ease;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            margin-bottom: 8px;
        }
        
        .step.active .step-circle {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--background);
        }
        
        .step.completed .step-circle {
            background: var(--success);
            border-color: var(--success);
            color: #FFF;
        }
        
        .step-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
        }
        
        .step.active .step-label {
            color: var(--primary);
        }
        
        .step.completed .step-label {
            color: var(--success);
        }
        
        /* Form Styles */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-grid {
            display: grid;
            gap: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text);
        }
        
        .form-label.required::after {
            content: ' *';
            color: var(--error);
        }
        
        .form-input {
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 16px;
            transition: var(--transition);
            width: 100%;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }
        
        .form-input.error {
            border-color: var(--error);
        }
        
        .form-error {
            color: var(--error);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .form-error.show {
            display: block;
        }
        
        .form-select {
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 16px;
            transition: var(--transition);
            width: 100%;
            cursor: pointer;
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }
        
        .radio-group {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
        }
        
        .radio-option:hover {
            border-color: var(--primary);
        }
        
        .radio-option.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--background);
        }
        
        .radio-option input[type="radio"] {
            display: none;
        }
        
        .radio-label {
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 8px;
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: var(--primary);
        }
        
        .form-checkbox label {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .form-checkbox a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .form-checkbox a:hover {
            text-decoration: underline;
        }
        
        .conditional-field {
            margin-top: 16px;
            padding: 16px;
            background: var(--background);
            border-radius: 12px;
            border: 1px solid var(--border);
            display: none;
        }
        
        .conditional-field.show {
            display: block;
        }
        
        .form-textarea {
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 16px;
            transition: var(--transition);
            width: 100%;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }
        
        /* Button Styles */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 32px;
            gap: 16px;
        }
        
        .form-button {
            background: var(--primary);
            color: var(--background);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .form-button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .form-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .form-button-secondary {
            background: var(--background);
            color: var(--text);
            border: 2px solid var(--border);
        }
        
        .form-button-secondary:hover:not(:disabled) {
            background: var(--surface-light);
            border-color: var(--text-secondary);
        }
        
        .form-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Screen */
        .success-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-screen.show {
            display: block;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 40px;
        }
        
        .success-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .success-message {
            color: var(--text-secondary);
            margin-bottom: 32px;
            line-height: 1.5;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            z-index: 1000;
        }
        
        .theme-toggle:hover {
            background: var(--surface-light);
            transform: scale(1.05);
        }
        
        /* Responsive Design */
        @media (max-width: 640px) {
            .registration-card {
                padding: 24px;
                margin: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stepper {
                margin-bottom: 24px;
            }
            
            .step-label {
                font-size: 10px;
            }
            
            .form-navigation {
                flex-direction: column;
            }
            
            .form-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="registration-container">
        <!-- Theme Toggle -->
        <button id="theme-toggle" class="theme-toggle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>

        <!-- Header -->
        <header class="registration-header">
            <div class="registration-logo">OPTIONSHARES</div>
            <div class="registration-tagline">Premium Trading Platform</div>
        </header>

        <!-- Main Content -->
        <main class="registration-main">
            <div class="registration-card">
                <h1 class="registration-title">Create Your Account</h1>
                <p class="registration-subtitle">Join Broker and start your trading journey</p>
                
                <!-- Stepper -->
                <div class="stepper">
                    <div class="stepper-progress" id="stepper-progress"></div>
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Personal Info</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Account Details</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Compliance</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Review</div>
                    </div>
                </div>

                <!-- Registration Form -->
                <form id="registration-form">
                    <!-- Step 1: Personal Information -->
                    <div class="form-step active" data-step="1">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">Full Name</label>
                                <input type="text" id="full_name" class="form-input" placeholder="Enter your full name" required>
                                <div class="form-error" id="full_name-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Email Address</label>
                                <input type="email" id="email" class="form-input" placeholder="your@email.com" required>
                                <div class="form-error" id="email-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Phone Number</label>
                                <input type="tel" id="phone" class="form-input" placeholder="+1 (555) 123-4567" required>
                                <div class="form-error" id="phone-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Date of Birth</label>
                                <input type="date" id="dob" class="form-input" required>
                                <div class="form-error" id="dob-error"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Account Details -->
                    <div class="form-step" data-step="2">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">Password</label>
                                <input type="password" id="password" class="form-input" placeholder="Create a strong password" required>
                                <div class="form-error" id="password-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Confirm Password</label>
                                <input type="password" id="confirm_password" class="form-input" placeholder="Confirm your password" required>
                                <div class="form-error" id="confirm_password-error"></div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required">Address Line 1</label>
                                    <input type="text" id="address_line1" class="form-input" placeholder="Street address" required>
                                    <div class="form-error" id="address_line1-error"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Address Line 2</label>
                                    <input type="text" id="address_line2" class="form-input" placeholder="Apartment, suite, etc.">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required">City</label>
                                    <input type="text" id="city" class="form-input" placeholder="City" required>
                                    <div class="form-error" id="city-error"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required">State/Province</label>
                                    <input type="text" id="state" class="form-input" placeholder="State" required>
                                    <div class="form-error" id="state-error"></div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required">Country</label>
                                    <select id="country" class="form-select" required>
                                        <option value="">Select Country</option>
                                        <option value="US">United States</option>
                                        <option value="CA">Canada</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="AU">Australia</option>
                                        <option value="DE">Germany</option>
                                        <option value="FR">France</option>
                                        <option value="JP">Japan</option>
                                        <option value="SG">Singapore</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                    <div class="form-error" id="country-error"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label required">Postal Code</label>
                                    <input type="text" id="postal_code" class="form-input" placeholder="Postal code" required>
                                    <div class="form-error" id="postal_code-error"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Occupation</label>
                                <input type="text" id="occupation" class="form-input" placeholder="Your occupation" required>
                                <div class="form-error" id="occupation-error"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Compliance -->
                    <div class="form-step" data-step="3">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">New to investing?</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="new_to_investing" value="yes" required>
                                        <span class="radio-label">Yes</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="new_to_investing" value="no" required>
                                        <span class="radio-label">No</span>
                                    </label>
                                </div>
                                <div class="form-error" id="new_to_investing-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Politically Exposed Person (PEP)?</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="pep" value="no" required>
                                        <span class="radio-label">No</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="pep" value="yes" required>
                                        <span class="radio-label">Yes</span>
                                    </label>
                                </div>
                                <div class="form-error" id="pep-error"></div>
                            </div>
                            
                            <div class="conditional-field" id="pep-details-field">
                                <div class="form-group">
                                    <label class="form-label required">PEP Details</label>
                                    <textarea id="pep_details" class="form-textarea" placeholder="Please provide details about your political exposure..."></textarea>
                                    <div class="form-error" id="pep_details-error"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Referral Code (Optional)</label>
                                <input type="text" id="referral_code" class="form-input" placeholder="Enter 10-character code" maxlength="10">
                                <div class="form-error" id="referral_code-error"></div>
                            </div>
                            
                            <div class="form-checkbox">
                                <input type="checkbox" id="terms" required>
                                <label for="terms">
                                    I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a>. I understand that my account will require verification by the Back Office before I can start trading.
                                </label>
                            </div>
                            <div class="form-error" id="terms-error"></div>
                        </div>
                    </div>

                    <!-- Step 4: Review -->
                    <div class="form-step" data-step="4">
                        <div class="form-grid">
                            <h3 style="margin-bottom: 20px;">Review Your Information</h3>
                            <div id="review-content" style="background: var(--background); padding: 20px; border-radius: 12px; line-height: 1.6;">
                                <!-- Review content will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Form Navigation -->
                <div class="form-navigation">
                    <button type="button" id="prev-btn" class="form-button form-button-secondary" style="display: none;">
                        ← Previous
                    </button>
                    <button type="button" id="next-btn" class="form-button">
                        Next →
                    </button>
                    <button type="button" id="submit-btn" class="form-button" style="display: none;">
                        <span id="submit-btn-text">Create Account</span>
                        <div id="submit-spinner" class="form-spinner" style="display: none;"></div>
                    </button>
                </div>

                <!-- Success Screen -->
                <div class="success-screen" id="success-screen">
                    <div class="success-icon">✓</div>
                    <h2 class="success-title">Registration Successful!</h2>
                    <p class="success-message">
                        Your account has been created successfully. Please note that your account requires verification by our Back Office team before you can start trading. You will receive an email once your account is verified.
                    </p>
                    <button class="form-button" onclick="window.location.href='/login.html'">
                        Go to Login
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/env.js"></script>
    <script type="module" src="/src/js/supabaseClient.js"></script>
    <script type="module" src="/src/js/auth.js"></script>
    <script type="module" src="/src/js/authGuard.js"></script>
    <script type="module" src="/src/js/ui/notify.js"></script>
    <script type="module" src="/src/js/ui/components.js"></script>
    <script type="module" src="/src/js/pages/register.js"></script>
</body>
</html>
